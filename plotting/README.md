plotting
--------

These are tools for dealing directly with the HPGL output from CLO3D.

CLO3D's pattern plot output is kind of a mess. It includes no metadata
or structural separation to indicate which lines are intended as
references marks and which lines are intended as cut
perimeters. Additionally, while it goes out of its way to ensure that
the CAD pattern perimeters are plotted as continuous lines, it outputs
seam allowance lines (where one *actually* cuts the cloth) as a series
of individual segments with 'PEN UP' commands between them. This
results in very poor quality cuts at the corners, as compared to a
continuous line.

Thus, as-exported, the CLO3D plotter commands are only appropriate for
automated marking, not cutting.


mark_cuts
---------

This is a GUI tool used to mark which lines on a pattern plot are
meant to be cut.

Basic invocation is simply `mark_cuts path/to/pattern.plt`. It will
automatically create a new file in the same directory, with name based
on the original file plus a `-preprocessed.plt` suffix. There is no
need to manually save the file inside of `mark_cuts`, as every
operation will update the `-preprocessed.plt`. No operation modifies
the original file.

The `mark_cuts` window shows two versions of the loaded pattern. On
the left is the original pattern, and on the right is the
pre-processed version generated by the tool from your choices. You can
zoom in on the pattern with your mouse's scroll wheel, and you can pan
around the pattern by clicking and dragging.

Because patterns often have multiple overlapping lines, you can hold
the `<SHIFT>` key to "jitter" the plotting blocks. This will visually
offset every block by a random amount, allowing you to interact with
an individual line that otherwise would be overlapped. THIS IS A
VISUAL EFFECT ONLY AND IS NEVER SAVED AS PART OF THE PATTERN.

To mark an individual plotting block for cutting, simply left-click it
in the left-hand pattern display. All lines included in the contiguous
plotting commands from that plotting block will be highlighted in red
on the left-hand display. The lines may describe a closed figure, but
more likely only a single line segment will highlight (this is why we
need this program). To unmark a block, simply click it again, and it
will return to 'pen' status. You can middle-click to unmark *all
blocks under the cursor* (not just one).

The right-hand display indicates cut lines in two ways. Open cut
blocks are highlighted in red, just like the left-hand display. Cut
blocks that describe a contiguous closed figure are highlighted in
cyan.

As you add cut lines in the left-hand display, `mark_cuts` will
automatically attempt to connect them together (ideally to form closed
figures). For unambiguous situations, like most seam-allowance lines,
this works really well. Where there are multiple overlapping lines,
especially multiple different figures meeting at common points, it can
make really silly choices.

You can also right-click on a block and `mark_cuts` will attempt to
automatically mark all connecting blocks for cutting. This uses
basically the same logic as the optimizer above, so it can give some
pretty weird results in ambiguous situations. But most seam allowance
lines (the primary thing we cut) can be marked for cutting in a single
right-click.

Pressing the `S` key will set the left-hand display to the current
right-hand pattern--retaining merged closed figures. This does not
alter the file on disk at all. But because `mark_cuts` will not
attempt to merge existing closed figures with newly-marked open cuts,
freezing your work on the pattern in this way can make it much easier
to create closed cuts in complicated/ambiguous areas where the
software would otherwise make poor merge decisions.

Behind the scenes, `mark_cuts` generates new plotter output and
modifies existing commands. Specifically, it adds new `SP,PU,PD,PU`
blocks for merged figures, and deletes the contituent original
blocks. It also modifies all blocks marked for cutting by changing the
pen number used to 'draw' that block: 2 for an open cut, 3 for a
closed cut. Other commands should pass through unchanged, although all
of these HPGL processing tools will throw away the last block of an
HPGL program if that block contains an `IN` or `PG` instruction.

Note: this tool depends on Kivy >=2.0 for graphics. I suggest trying to
get it from a PPA instead of `pip`, as the latter requires a number of
`-dev` libraries which are not managed by the Python package manager
anyway.


plotter_send
------------

This is a command-line program for sending a *preprocessed* plot to
the actual plotter. Execute it like
`plotter_send --draw /dev/plotter_serial_port /path/to/file-preprocessed.plt`.

If (and only if) you're using `--dry-run`, it's okay to specify
`/dev/null` as the serial port. You can change the plotter settings
with `--plotter`, although settings are only input right now for the
USCutter Titan3 series.

`--preview` will use the `hp2xx` program to generate preview plots of
the overlayed pen and knife passes. This is intended to be as accurate
a simulation of the actual plotter results as is possible, but
fidelity is dependent on the similarity of `hp2xx` and your
plotter. You will be given the option to either accept the preview
plot and continue sending the program to the plotter; or reject the
preview and abort the run.

There are several options to control what is plotted/cut and how it's
done.

`--draw` and `--cut` control whether the pen-drawing and knife-cutting
passes are plotted, respectively. If neither is given, the program
will abort. If you choose both, a prompt will appear between the pen
pass and the knife pass, allowing you to swap out the tools before
continuing.

`--mirror` will manipulate the initialization block to flip the plot
in the Y axis. This is intended for working with the back (wrong) side
of material.

`--repeat` will repeat each individual *cut* block the configured
number of times. This is intended for light-pressure, multi-pass
cutting operations. The pen pass is not repeated.




